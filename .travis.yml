os: linux
dist: bionic
language: java
install:
  # debian-supplied pandoc is very old --> install manually
  - pandoc_deb="pandoc-2.9.1-1-amd64.deb"
  - wget "https://github.com/jgm/pandoc/releases/download/2.9.1/${pandoc_deb}"
  - sudo dpkg -i ${pandoc_deb}
  - rm ${pandoc_deb}

  # default textlife from apt-get is too old (2017)
  # install the latest texlife version manually
  - REMOTE="http://mirror.ctan.org/systems/texlive/tlnet"
  - INSTALL="/tmp/install-texlive"
  - mkdir -p $INSTALL
  - curl -sSL $REMOTE/install-tl-unx.tar.gz | tar -xzv -C $INSTALL --strip-components=1
  - sudo $INSTALL/install-tl -no-gui -profile .texlife.profile
  - VERSION=$($INSTALL/install-tl --version | grep 'version' | grep -o '[0-9]\{4\}')
  - PLATFORM=$($INSTALL/install-tl --print-platform)
  - TEXBIN="/usr/local/texlive/${VERSION}/bin/${PLATFORM}"
  - export "PATH=$TEXBIN:$PATH"

  # Initialization and packages for tlmgr
  - sudo apt-get install xzdec
  - tlmgr init-usertree

  # for rendering the PDFs
  - sudo apt-get install poppler-utils

  # for executing python based pandoc filters
  - sudo apt-get install python3
  - sudo apt-get install python3-pip
  - sudo pip3 install --upgrade setuptools

  # install python filters
  - pip3 install pandoc-latex-environment

  # packages needed for the template
  - sudo tlmgr install xecjk filehook unicode-math ucharcat pagecolor babel-german ly1 mweights sourcecodepro sourcesanspro mdframed needspace fvextra footmisc footnotebackref background

  # packages only needed for some examples (that include packages via header-includes)
  - sudo tlmgr install awesomebox fontawesome5
before_script:
  - cd examples
script:
  - sh build-examples.sh